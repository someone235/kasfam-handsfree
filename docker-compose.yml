version: "3.9"

services:
  web:
    build: .
    image: kaspa-handsfree:latest
    restart: unless-stopped
    environment:
      OPENAI_API_KEY: ${OPENAI_API_KEY}
      ADMIN_PASSWORD: ${ADMIN_PASSWORD}
      SQLITE_DB_PATH: /data/app.db
      PORT: "4000"
      APP_MODE: server
    network_mode: host
    volumes:
      - kaspa-data:/data

  processor:
    build: .
    image: kaspa-handsfree:latest
    restart: "no"
    environment:
      OPENAI_API_KEY: ${OPENAI_API_KEY}
      SQLITE_DB_PATH: /data/app.db
      APP_MODE: cli
      X_API_KEY: ${X_API_KEY}
      X_API_SECRET: ${X_API_SECRET}
      X_ACCESS_TOKEN: ${X_ACCESS_TOKEN}
      X_ACCESS_TOKEN_SECRET: ${X_ACCESS_TOKEN_SECRET}
      DEFAULT_SOURCE: ${DEFAULT_SOURCE:-kaspa-news}
    volumes:
      - kaspa-data:/data

volumes:
  kaspa-data:
